---
# yaml-language-server: $schema=https://schema.blue-build.org/module-stage-list-v1.json
modules:
  - type: dnf
    repos:
      copr:
        - name: karmab/kcli
          chroot: fedora-%OS_VERSION%-x86_64
        - name: gmaglione/podman-bootc
          chroot: fedora-%OS_VERSION%-x86_64
    install:
      packages:
        - libvirt
        - libvirt-nss
        - virt-manager
        - virt-viewer
        - virt-install
        - virt-v2v
        - edk2-ovmf
        # COPR packages
        - kcli
        - podman-bootc

  # Create libvirt-workaround.service for SELinux relabeling
  - type: files
    files:
      - source: usr/lib/tmpfiles.d/libvirt-workaround.conf
        destination: /usr/lib/tmpfiles.d/libvirt-workaround.conf

  # Copy libvirt group setup script
  - type: files
    files:
      - source: usr/libexec/dx-libvirt-groups
        destination: /usr/libexec/dx-libvirt-groups
        mode: "0755"

  # Enable libvirt services
  - type: systemd
    system:
      enabled:
        - dx-libvirt-groups.service
        - libvirt-workaround.service
